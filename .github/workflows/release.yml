name: VerÃ¶ffentliche Release

on:
  push:
    tags:
      - 'v*'

jobs:
  create-release:
    runs-on: ubuntu-latest
    
    steps:
      - name: Repository auschecken
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Release-Artefakte vorbereiten
        run: |
          mkdir -p release-assets
          
          # Artefakt 1: Ohne node_modules
          tar --exclude='.git' \
              --exclude='node_modules' \
              --exclude='npm-debug.log' \
              --exclude='.env' \
              --exclude='.env.local' \
              --exclude='*.log' \
              -czf release-assets/nextcloud-verein-${{ github.ref_name }}.tar.gz .
          
          # Artefakt 2: Mit vorkompiliertem Bundle
          cp release-assets/nextcloud-verein-${{ github.ref_name }}.tar.gz \
             release-assets/nextcloud-verein-${{ github.ref_name }}-release.tar.gz

      - name: Release-Notizen generieren
        id: release_notes
        run: |
          cat > RELEASE_BODY.md << 'EOF'
          # ğŸ‰ Nextcloud Vereins-App v${{ github.ref_name }}

          ## ğŸŒŸ Was ist neu

          Diese **Alpha-Version (v0.1.0)** bietet die KernfunktionalitÃ¤t fÃ¼r die Verwaltung von Vereinen und Organisationen.

          ### âœ¨ Hauptmerkmale

          #### ğŸ‘¥ Mitgliederverwaltung
          - âœ… Mitglieder anlegen, bearbeiten, lÃ¶schen
          - âœ… Mitgliederdaten: Name, E-Mail, Adresse, IBAN, BIC
          - âœ… Rollen-Management: Mitglied, Kassierer, Admin
          - âœ… Responsive Tabelle mit Inline-Editing
          - âœ… Suchfunktion

          #### ğŸ’° Finanzverwaltung
          - âœ… GebÃ¼hren und Beitragsverfolgung
          - âœ… Status-Tracking: offen, bezahlt, Ã¼berfÃ¤llig
          - âœ… Statistiken: GesamtausstÃ¤nde, eingezahlte BetrÃ¤ge
          - âœ… GebÃ¼hrentabelle mit Bearbeitungs- und LÃ¶schfunktion
          - âœ… Nach Mitgliedern filtern

          #### ğŸ¨ Benutzer-Erlebnis
          - âœ… Dark Mode Support
          - âœ… Responsive Design (Desktop, Tablet, Mobile)
          - âœ… Nextcloud-native Authentifizierung
          - âœ… Moderne Vue 3 + Vite Frontend
          - âœ… Keine Fehler in der Browserkonsole

          ---

          ## ğŸ“‹ Anforderungen

          - **Nextcloud**: 28.0 oder hÃ¶her
          - **PHP**: 8.1 oder hÃ¶her
          - **Datenbank**: MySQL/MariaDB oder PostgreSQL
          - **Browser**: Modern (Chrome, Firefox, Safari, Edge)

          ---

          ## ğŸ”§ Installation

          ### Methode 1: Aus dem Release (Einfach)

          1. Herunterladbare Datei herunterladen: `nextcloud-verein-${{ github.ref_name }}-release.tar.gz`
          2. In `/var/www/nextcloud/apps/` extrahieren:
             ```bash
             cd /var/www/nextcloud/apps/
             tar -xzf nextcloud-verein-${{ github.ref_name }}-release.tar.gz
             mv nextcloud-verein-${{ github.ref_name }} verein
             ```
          3. App aktivieren:
             ```bash
             sudo -u www-data php /var/www/nextcloud/occ app:enable verein
             ```
          4. Zugreifen unter: `https://your-nextcloud/apps/verein/`

          ### Methode 2: Aus dem Quellcode (Entwicklung)

          1. Repository klonen:
             ```bash
             cd /var/www/nextcloud/apps/
             git clone https://github.com/Wacken2012/nextcloud-verein.git verein
             cd verein
             ```
          2. AbhÃ¤ngigkeiten installieren:
             ```bash
             npm install
             npm run build
             ```
          3. App aktivieren:
             ```bash
             sudo -u www-data php /var/www/nextcloud/occ app:enable verein
             ```

          ---

          ## âœ… Getestete & funktionierende Funktionen

          - âœ… Mitglieder-CRUD (Create, Read, Update, Delete)
          - âœ… GebÃ¼hren-CRUD
          - âœ… Statistiken-Dashboard
          - âœ… Dark Mode
          - âœ… Responsive Design
          - âœ… API-Integration
          - âœ… Nextcloud-Authentifizierung

          ---

          ## âš ï¸ Bekannte EinschrÃ¤nkungen

          - âš ï¸ **Keine Berechtigungsverwaltung**: Alle angemeldeten Benutzer kÃ¶nnen alle Daten sehen/Ã¤ndern
          - âš ï¸ **Keine Datenexporte**: CSV/PDF-Export nicht implementiert
          - âš ï¸ **Keine Tests**: Unit/Integration Tests ausstehend
          - âš ï¸ **Keine Dokumentation im Code**: Inline-Kommentare minimal
          - âš ï¸ **Alpha-Status**: MÃ¶glicherweise Bugs, API kann sich Ã¤ndern

          ---

          ## ğŸ—“ï¸ Roadmap

          ### v0.2.0 (Dezember 2025)
          - Berechtigungsverwaltung (Ansicht, Bearbeitung, Admin)
          - CSV-Export fÃ¼r Mitglieder und GebÃ¼hren
          - GebÃ¼hrenerinnerungen (E-Mail-Benachrichtigungen)

          ### v0.3.0 (Januar 2026)
          - Kalender-Integration (Nextcloud Calendar)
          - GebÃ¼hrenplan und automatische Rechnungen
          - Mitgliedsantragsformular

          ### v1.0.0 (MÃ¤rz 2026)
          - VollstÃ¤ndige Dokumentation
          - Unit- und Integration-Tests
          - Performance-Optimierungen
          - Nextcloud AppStore-VerÃ¶ffentlichung

          ---

          ## ğŸ“š Dokumentation

          - [README.md](https://github.com/Wacken2012/nextcloud-verein/blob/main/README.md) - Hauptdokumentation
          - [INSTALLATION.md](https://github.com/Wacken2012/nextcloud-verein/blob/main/INSTALLATION.md) - Installationsanleitung
          - [ROADMAP.md](https://github.com/Wacken2012/nextcloud-verein/blob/main/ROADMAP.md) - Entwicklungsplan
          - [LIZENZ: AGPL-3.0](https://github.com/Wacken2012/nextcloud-verein/blob/main/LICENSE)

          ---

          ## ğŸ§ª Zum Testen

          1. App auf Nextcloud-Instanz installieren
          2. Zum Tab **"Mitglieder"** navigieren und ein Mitglied hinzufÃ¼gen
          3. Zum Tab **"Finanzen"** gehen und eine GebÃ¼hr erstellen
          4. Dark Mode testen: Nextcloud-Einstellungen > Erscheinungsbild
          5. Auf mobilen GerÃ¤ten testen
          6. Browser-Konsole auf Fehler prÃ¼fen (F12)

          ---

          ## ğŸ’¬ Feedback & Fehlermeldungen

          Bitte erstellen Sie ein [Issue auf GitHub](https://github.com/Wacken2012/nextcloud-verein/issues) fÃ¼r:
          - ğŸ› Fehlerberichte
          - ğŸ’¡ Feature-Anfragen
          - ğŸ¨ Design-Verbesserungen
          - ğŸ“ Dokumentations-Verbesserungen

          ---

          ## ğŸ“„ Lizenz

          Diese App ist lizenziert unter der **AGPL-3.0 Lizenz** - siehe [LICENSE](LICENSE) fÃ¼r Details.

          ---

          ## ğŸ‘ Credits

          Entwickelt mit â¤ï¸ fÃ¼r Nextcloud-Benutzer und Vereinsverwaltungen.

          **Danke** an die Nextcloud-Community und alle Mitwirkenden!
          EOF
          cat RELEASE_BODY.md

      - name: GitHub Release erstellen
        uses: softprops/action-gh-release@v1
        with:
          body_path: RELEASE_BODY.md
          prerelease: true
          files: |
            release-assets/nextcloud-verein-${{ github.ref_name }}.tar.gz
            release-assets/nextcloud-verein-${{ github.ref_name }}-release.tar.gz
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
